{
  "hash": "a456fe5bcd6950ef23c63d83b4204c5a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: ''\naliases: []\nid: alphabeta-sim-tros01\ntags: []\nexecute:\n  echo: false\n  warning: false\n---\n\n{{<pagebreak>}}\n\nTohle je ta část, kde to začalo být zajímavé. A taky frustrující. Měl jsem za úkol vyřešit koncovku **2 králové proti 1 králi**. Zní to jako jasná věc, ne? Máte přesilu, prostě ho umlátíte. Jenže donutit deterministický algoritmus, aby soupeře skutečně *hnal* do rohu a ne jenom tančil kolem něj, se ukázalo jako docela solidní oříšek.\n\nCílem bylo postavit agenta, který nejen že vyhraje, ale vyhraje **efektivně** a spolehlivě. Žádné náhodné poťouchlosti, ale čistá strojová dominance.\n\n**Vizualizace herního stromu (Obrázek `\\ref{fig-assignment}`{=latex} na titulní straně)**\n\nNa titulním obrázku (Obrázek `\\ref{fig-assignment}`{=latex}) je vidět, jak jsem ten problém vlastně řešil, tedy alespoň z počátku. \n\nJe to klasický Minimax s Alpha-Beta ořezáváním, ale v praxi to vypadá spíš jako prohledávání obrovského stromu možností:\n- **MAX uzly**: To jsem já, snažím se urvat co nejvíc bodů.\n- **MIN uzly**: To je soupeř, snaží se mi to zkazit.\n- **Ořezávání (Pruning)**: To jsou ty šedé větve. Vizualizovat celý strom bez prořezání by v tomhle měřítku nedávalo smysl – jak ukazují moje testy (`tests.md`), i pro jednoduché stavy generuje hrubá síla tisíce uzlů (např. 2090 vs 0 pro manuální cestu). Byl by to jen jeden velký nepřehledný \"blob\".\n- **Minimalizace**: Proto zde ukazuji **pouze nezbytné minimum** – kritickou cestu (Principal Variation), kterou jsem identifikoval během manuální analýzy jako vítěznou. Vše ostatní je šum, který nás v tuto chvíli nezajímá. Neukazujeme \"prohledávání\", ukazujeme \"řešení\".\n\n## Klíčové momenty a Strategie\n\nTady jsem sepsal věci, na které jsem přišel metodou pokus-omyl (hodně omylů). Abych tu hru dohrál, musel jsem pochopit, jak se ty kameny vlastně mají chovat.\n\n### Proč manuální simulace?\nMožná se ptáte, proč jsem prostě nepustil 10 000 automatických her a neanalyzoval logy. Odpověď je jednoduchá: **Intuice**.\nKdyž koukáte na logy ve formátu `Score: 4120, Move: 14-9`, nevidíte *proč* se to děje. Nevidíte tu frustraci, když agent sice neprohraje, ale 50 tahů jenom chodí tam a zpátky.\nMusel jsem si tu hru \"ohmatat\". Vzít figurky (nebo myš v simulátoru), zkusit hrát za toho \"hloupého\" soupeře a zjistit, kde má můj agent slabiny. Jedině tak jsem pochopil, že mi chybí koncept \"pasti\" nebo \"kotvy\".\n\n### Strategické imperativy\n\n1.  **2 na 1 je nutnost**: Přijít o jednoho krále znamená remízu. Game over. Takže výměny jsou absolutní tabu.\n2.  **Vytlačit z centra**: Soupeř se chce držet uprostřed (tam má nejvíc možností). Já ho musím narvat do rohu jak do pytle.\n3.  **Past (The Net)**: Nestačí ho jen tlačit. Musím kolem něj utáhnout smyčku. Spolupráce obou mých králů je klíčová.\n\n### Role králů: Kotva a Operátor\n\nTohle byl asi největší \"aha moment\". Moji králové nemůžou dělat to samé. Musí si rozdělit role:\n-   **Kotva (The Anchor)**: Jeden stojí a hlídá ústupovou cestu (kempí).\n-   **Operátor (The Operator)**: Druhý aktivně doráží a zmenšuje soupeři manévrovací prostor.\n\nKdyž se snažili oba dorážet najednou, akorát si překáželi.\n\n***\n\n## Detailní rozbor heuristiky (Periodic Blocks)\n\nTady rozeberu, jak jsem tyhle myšlenky přetavil do kódu. Každou část heuristiky jsem si musel obhájit, nasimulovat a vyladit.\n\n### 1. Materiál a Bezpečnost (1v1 Protection)\n\n#### Požadavek\nZabránit za každou cenu výměně, která by vedla k remíze (1 vs 1).\n\n#### Diskuze\nV běžné střední hře je výměna 1:1 přijatelná. V koncovce 2:1 je to fatální chyba. Heuristika musí vnímat stav 1:1 jako \"zakázaný\" (loss condition).\n\n#### Matematika\n$$\nh_{material} = \\begin{cases} \n-\\infty & \\text{pokud } N_{my}=1 \\land N_{opp}=1 \\\\\nw_{mat} \\cdot (N_{my} - N_{opp}) & \\text{jinak}\n\\end{cases}\n$$\n\n#### Analýza limitů a extrémů\n- **Extrém (Loss Condition):** Pokud $N_{my} \\to 1$, funkce okamžitě padá do $-\\infty$. Toto není soft-limit, ale hard-constraint. Algoritmus raději obětuje cokoliv jiného, než aby dopustil tento stav.\n- **Běžný stav:** V drtivé většině času je hodnota konstantní ($300+300-300 = 300$). Materiál v koncovce 2v1 nerozhoduje, rozhoduje pozice.\n\n\n#### Implementace\n```{.julia include=\"/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/2..simulace/src/heuristics.jl\" region=\"perfect_1v1\" dedent=\"true\"}\n```\n\n### 2. Pozice a Kontrola (Red Position)\n\n#### Požadavek\nDonutit soupeře opustit bezpečné \"dvojité rohy\" (pole 1, 5, 28, 32).\n\n#### Diskuze\nČervený král v rohu je v bezpečí. Nemůžeme ho vyhodit, pokud neudělá chybu. Musíme ho aktivně \"vytlačit\" nebo \"vykouřit\" tím, že mu obsadíme sousední pole a donutíme ho k tahu (tzv. *zugzwang*).\n\n#### Implementace\n```{.julia include=\"/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/2..simulace/src/heuristics.jl\" region=\"perfect_red_pos\" dedent=\"true\"}\n```\n\n1. Penalta: Červený v bezpečné zóně (dvojitý roh) — agent ho chce vytlačit.\n2. Bonus: Červený opustil bezpečí — úspěšné vytlačení.\n\n### 3. Koordinace (Coordination & Squeeze)\n\n#### Požadavek\nKrálové musí spolupracovat. Jeden sám nic nezmůže.\n\n#### Diskuze\nZavedli jsme koncept \"optimální vzdálenosti\". Pokud jsou naši králové příliš daleko od sebe (>6 polí), nemohou si krýt záda. Pokud jsou příliš blízko (1 pole), překážejí si. Ideální vzdálenost je 2-4 pole.\n\n#### Matematika\nHeuristika uděluje bonus $w_{coord}$, pokud:\n$$ 2 \\le dist(K_1, K_2) \\le 4 $$\n\n#### Analýza limitů a extrémů\n- **Dolní extrém ($dist < 2$):** Pokud se králové \"lepí\" na sebe ($dist=1$), překážejí si v pohybu. Funkce toto penalizuje, protože efektivní útok vyžaduje, aby jeden král mohl obejít druhého.\n- **Horní extrém ($dist > 6$):** Pokud jsou od sebe přes celou desku, nemohou vytvořit síť. Soupeř snadno proklouzne mezi nimi.\n- **Optimum ($dist \\in [2,4]$):** \"Sweet spot\". Králové jsou dost blízko na podporu, ale dost daleko na to, aby pokryli šířku desky.\n\n\n#### Implementace\n```{.julia include=\"/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/2..simulace/src/heuristics.jl\" region=\"perfect_coordination\" dedent=\"true\"}\n```\n\n1. Bonus za koordinaci králů ve vzdálenosti 2–6 polí.\n2. Squeeze — sevření soupeře, bonus roste s blízkostí.\n\n### 4. Past a Síť (Net Formation)\n\n#### Požadavek\nVytvořit formaci, ze které není úniku.\n\n#### Diskuze\nToto je nejpokročilejší část heuristiky. Detekujeme, který král je blíže k rohu (\"Kotva\") a od druhého (\"Operátor\") vyžadujeme, aby se pohyboval po diagonále **směrem od rohu**, čímž uzavírá síť. Bez této složky by agent soupeře jen \"honil\" kolem dokola.\n\n#### Geometrická definice\nSíť je definována vektorem mezi Kotvou ($K_A$) a Operátorem ($K_O$).\n- **Podmínka:** $K_O$ musí ležet na diagonále $d$, která je kolmá na spojnici $K_A \\to Roh$.\n- **Extrém:** Pokud se $K_O$ přiblíží k rohu ($dist(K_O, Roh) \\to 0$), síť kolabuje (\"Crowding\").\n- **Cíl:** Maximalizovat $dist(K_O, Roh)$ při zachování diagonální vazby. Tím se síť roztahuje a vytlačuje soupeře.\n\n\n#### Implementace\n```{.julia include=\"/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/2..simulace/src/heuristics.jl\" region=\"perfect_net\" dedent=\"true\"}\n```\n\n1. Net bonus: Operátor na správné diagonále.\n2. Crowding penalta: Operátor příliš blízko rohu.\n\n### 5. Prevence patu a ústupu (Retreat Penalty)\n\n#### Požadavek\nHra musí konvergovat k cíli. Nesmíme dovolit nekonečné manévrování.\n\n#### Diskuze\nObčas se stane, že AI \"nevidí\" cestu k výhře v rámci horizontu (depth limit) a rozhodne se \"čekat\" (ustoupit). Abychom tomu předešli, penalizujeme stavy, kde se průměrná vzdálenost k soupeři zvyšuje.\n\n#### Implementace\n```{.julia include=\"/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/2..simulace/src/heuristics.jl\" region=\"perfect_retreat\" dedent=\"true\"}\n```\n\n1. Tvrdá penalta za velkou průměrnou vzdálenost — promarněná příležitost.\n2. Střední penalta za mírné oddálení.\n3. Penalta za nejbližšího krále stále daleko.\n\n***\n\n## Analýza Výsledků a Parametry\n\nNásledující tabulka shrnuje váhy použité ve finální verzi heuristiky (`perfect_endgame_heuristic`). Tyto hodnoty byly laděny pomocí ablačních studií.\n\n::: {#tbl-params .cell tbl-cap='Parametry heuristické funkce (načteno z kódu)' execution_count=1}\n| Komponenta | Váha | Význam |\n|---|---|---|\n| **Bonus: Červený aktivní** | `500.0` | Koeficient v lineární kombinaci |\n| **Koordinace králů** | `300.0` | Koeficient v lineární kombinaci |\n| **Přeplnění (Crowding)** | `-800.0` | Koeficient v lineární kombinaci |\n| **Materiál (Základ)** | `100.0` | Koeficient v lineární kombinaci |\n| **Mobilita soupeře** | `600.0` | Koeficient v lineární kombinaci |\n| **Past (Net Formation)** | `1200.0` | Koeficient v lineární kombinaci |\n| **Penalta: Ústup (Max)** | `-1000.0` | Koeficient v lineární kombinaci |\n| **Penalta: Červený v bezpečí** | `-600.0` | Koeficient v lineární kombinaci |\n| **Sevření (Squeeze)** | `60.0` | Koeficient v lineární kombinaci |\n| **Výhra (Infinity)** | `10000.0` | Koeficient v lineární kombinaci |\n:::\n\n\n### Pozorování: Horizont Efekt\n\nPři hloubce prohledávání 6 (3 tahy každého) se stále setkáváme s \"Horizont efektem\". Agent může odsunout nevyhnutelnou prohru o tah dál, i když to z dlouhodobého hlediska nic neřeší. \n\n> **Řešení**: Zavedení \"pseudo-terminálních\" stavů (např. penalizace za ústup), které heuristicky simulují \"blížící se konec\", i když není přímo vidět ve stromu.\n\n***\n\n## Průběh hry (Manuální analýza)\n\nNásledující sekvence snímků (z Excalidraw) vizuálně demonstruje úspěšné uplatnění výše popsaných principů v praxi.\n\n<!--\n::: {#fig-game-phases layout-ncol=2}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=6plydeepbutstillstarting|Fáze 1 - Horizont efekt - AI vidí hrozbu, ale je těsně za horizontem.]]{#fig-phase1}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=safecornerblock|Fáze 2a - Safe Corner Block - Úspěšné zablokování úniku.]]{#fig-phase2a}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=doublecornerblunder|Fáze 2b - Ukázka chyby (Blunder) - Červený uniká.]]{#fig-phase2b}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=decisivemoment1|Fáze 3 - Vytlačení z rohu (Pushing).]]{#fig-phase3}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=expected-optimal-ply1|Fáze 4 - Formování pasti (Net building) - Kotva a Operátor.]]{#fig-phase4}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=needlesstodivedeeper|Fáze 5 - Vynucené tahy (Forced Moves).]]{#fig-phase5}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=insta-lost|Fáze 6 - Finální past (Impossible to escape).]]{#fig-phase6}\n\n![[/home/sim/Obsi/Prods/04-škola/Předměty/mgr3/4IZ431..AI1/Zpracováno/ang-dama-tros01/1..dohrání/minimaxalphabeta-assignment.excalidraw.md#^frame=forcedending|Fáze 7 - Vynucený konec (Forced Ending).]]{#fig-phase7}\n\nManuální analýza klíčových fází hry\n:::\n-->\n\n> **Poznámka:** Vizuální analýza fází hry (exporty z Excalidraw) není v této verzi dokumentu k dispozici. Odkazujeme na zdrojové soubory v repozitáři.\n\n***\n\n\n***\n\n## Případová studie: Rozhodování v Hloubce 6\n\nBěhem ladění heuristiky jsme narazili na kritickou situaci, kde AI v hloubce 6 (3 tahy každého) váhala mezi dvěma tahy. Tato situace krásně ilustruje, jak jemné změny v definici metriky ovlivňují chování agenta.\n\n**Konflikt:**\n- **Optimální tah (14-9)**: Vede přímo k obsazení klíčového bodu pro sestrojení pasti.\n- **Suboptimální tah (10-7)**: Vypadá bezpečně a udržuje vzdálenost, ale v reálu ztrácí tempo a dává soupeři šanci uniknout.\n\nPůvodní heuristika ohodnotila oba tahy téměř stejně. Důvodem byla **Manhattanská vzdálenost**, která v dámě (kde se chodí po diagonálách) měřila vzdálenost $\\Delta x + \\Delta y$ nepřesně. Pro krále jsou pole 9 a 2 topologicky stejně vzdálená (Vzdálenost 2), i když pole 9 je strategicky mnohem cennější.\n\n**Řešení:**\nPřechod na **Čebyševovu vzdálenost** ($\\max(|\\Delta x|, |\\Delta y|)$). Tato metrika správně identifikovala, že pole 5 (cíl) je z pole 9 dosažitelné za 1 krok (Vzdálenost 1), zatímco z pole 2 je to stále daleko.\n\n**Výsledek po úpravě:**\n- **Optimální tah (14-9)**: Skóre **4160.0** (Aktivní bonus za přiblížení).\n- **Suboptimální tah (10-7)**: Skóre **3670.0** (Bez bonusu).\n- **Rozdíl**: **+490.0** bodů jasně preferuje vítěznou variantu.\n\nTato změna umožnila agentovi najít vítěznou sekvenci: `14-9` $\\to$ `1-5` $\\to$ `10-14` $\\to$ `5-1` $\\to$ `9-5` $\\to$ `1-6` $\\to$ `5-1` $\\to$ `6-2` $\\to$ `14-18`.\n\n***\n\n### Co si z toho odnést?\nJakmile se podaří sestavit tu past (\"síť\"), je dobojováno. Heuristika pak dává tak jasná čísla, že Alpha-Beta ořeže skoro všechno a agent hraje bleskově. Ten pocit, když to konečně začalo fungovat a viděl jsem, jak červený král marně hledá únik, byl k nezaplacení.\n\n",
    "supporting": [
      "alphabeta-sim-tros01_files"
    ],
    "filters": []
  }
}